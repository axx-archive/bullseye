# Ralph Progress Log
Started: Fri Jan 23 18:07:41 PST 2026

## Codebase Patterns
- In scout-chat.tsx, use refs (useRef + useEffect to sync) instead of including unstable callbacks in useEffect dependency arrays
- Run `npm run lint -- <filepath>` to lint specific files; `npx tsc --noEmit` for typecheck
- The eslint rule `react-hooks/refs` forbids assigning ref.current during render — wrap in useEffect instead
- handleSendMessage has chatMessages in its useCallback deps, making it unstable — always access via ref for effects

---

## 2026-01-23 - US-001
- What was implemented: Fixed pendingScoutAttachment double-fire by adding a processingRef guard and using a handleSendMessageRef to avoid including the unstable handleSendMessage in the useEffect dependency array
- Files changed: src/components/scout/scout-chat.tsx
- **Learnings for future iterations:**
  - handleSendMessage depends on chatMessages via useCallback, so it changes on every message — never use it directly as a useEffect dep for effects that should fire once
  - The eslint react-hooks/refs rule disallows ref.current assignment during render — use a syncing useEffect instead
  - The processingRef pattern (set true before action, false after) prevents React StrictMode or fast state changes from re-triggering effects
---
