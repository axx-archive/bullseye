# Ralph Progress Log
Started: Fri Jan 23 05:42:50 PST 2026

## Codebase Patterns
- Prisma generated client outputs to `src/generated/prisma` and is gitignored — regenerate with `npx prisma generate`
- API routes use `include` (not `select`) so new model fields are automatically returned
- TypeScript types are manually maintained in `src/types/index.ts` — keep in sync with Prisma schema
- Optimistic updates in React Query hooks (e.g., `use-projects.ts`) must include all required fields from the interface
- Commit message format: `feat: [Story ID] - [Story Title]`
- Encryption utility at `src/lib/encryption.ts` uses AES-256-GCM with ENCRYPTION_KEY env var (32-byte hex)
- UserSettings model stores encrypted API keys — use `encrypt()`/`decrypt()` from encryption.ts

---

## 2026-01-23 - US-001
- Added `EvaluationStatus` enum (UNDER_CONSIDERATION, APPROVED, REJECTED) to Prisma schema
- Added `evaluationStatus` (default: UNDER_CONSIDERATION) and `sortOrder` (default: 0) fields to Project model
- Generated and applied migration `20260123134415_add_evaluation_status_and_sort_order`
- Updated `src/types/index.ts` with `EvaluationStatus` type and new fields on `Project` interface
- Fixed optimistic update in `src/hooks/use-projects.ts` to include new required fields
- Files changed: prisma/schema.prisma, src/types/index.ts, src/hooks/use-projects.ts, prisma/migrations/
- **Learnings for future iterations:**
  - When adding new required fields to the Project interface, check `use-projects.ts` optimistic updates
  - The migration_lock.toml file is created on first migration and should be committed
  - Prisma `include` returns all scalar fields by default, so API routes don't need changes for new fields
---

## 2026-01-23 - US-002
- Added `UserSettings` model to Prisma schema with: id, userId (unique, relation to User), claudeApiKeyEncrypted, claudeApiKeyIv, createdAt, updatedAt
- Added `settings` relation on User model pointing to UserSettings
- Generated and applied migration `20260123134700_add_user_settings`
- Created encryption utility at `src/lib/encryption.ts` using AES-256-GCM
- Utility exports `encrypt(plaintext)` returning `{ ciphertext, iv }` and `decrypt(ciphertext, iv)` returning plaintext
- Added ENCRYPTION_KEY to `.env.example` with comment explaining format
- Files changed: prisma/schema.prisma, src/lib/encryption.ts (new), .env.example, prisma/migrations/
- **Learnings for future iterations:**
  - AES-256-GCM auth tag is appended to ciphertext with `:` separator for storage in a single field
  - IV (12 bytes for GCM) stored separately to allow decryption
  - The encryption utility validates key length at runtime — will throw clear error if misconfigured
---
